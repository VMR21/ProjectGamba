<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ProjectGamba Slot Picker</title>
    <!-- New font for the Slot Picker -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800&display=swap" rel="stylesheet">
    <!-- General styles from the original site (only those relevant for player, glow, particles, etc.) -->
    <style>
        /* Draggable Player Styles */
        .draggable {
            position: fixed;
            bottom: 15px;
            right: 15px;
            width: 350px;
            height: 250px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            z-index: 1000;
            background: white;
            border: 2px solid #2775ca;
            box-shadow: 0 0 100px rgba(39, 117, 202, 1);
        }
        .controls {
            display: flex;
            align-items: center;
            background-color: #333;
            padding: 5px;
            cursor: move;
        }
        .drag-handle {
            flex-grow: 1;
            text-align: left;
            color: #2775ca;
            font-size: 20px;
            font-weight: 900;
            box-shadow: 0 0 100px rgba(39, 117, 202, 1);
            padding: 0 15px;
        }
        .close-btn {
            cursor: pointer;
            background: none;
            border: none;
            color: #2775ca;
            font-size: 20px;
            font-weight: 900;
            line-height: 30px;
            box-shadow: 0 0 100px rgba(39, 117, 202, 1);
            padding: 0 20px;
        }
        iframe {
            width: 100%;
            height: calc(100% - 40px);
            border: none;
        }
        .minimized-icon {
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            position: fixed;
            bottom: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            border-radius: 25px; /* Makes it round */
            background-color: #333;
            color: white;
            font-size: 30px;
            z-index: 1001; /* Should be above the draggable player */
            cursor: pointer;
            box-shadow: 0 0 100px rgba(39, 117, 202, 1);
        }
        .open-btn {
            background: none;
            border: none;
            color: #2775ca;
            font-size: 20px;
            font-weight: 900;
            cursor: pointer;
        }
        @media (max-width: 570px) {
            .draggable {
                left: 50%;
                transform: translateX(-50%);
                right: auto; /* Override right for centering */
            }
        }

        /* Particle and Glow Container Styles */
        body {
            margin: 0;
            /* Padding will be handled by the .app container */
            font-family: Nunito, system-ui, Arial; /* Use Nunito as primary font */
            color: var(--text);
            /* New background for Slot Picker, overrides original */
            background: radial-gradient(1200px 800px at 15% 0%, #1a1b36 0%, #0c0f16 45%) fixed,
                        radial-gradient(1000px 800px at 90% 30%, #122339 0%, #0c0f16 60%) fixed, var(--bg1);
            min-height: 100vh; /* Ensure body takes full height for background */
            display: flex; /* Flexbox for layout */
            flex-direction: column;
        }
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2; /* Below other content */
        }
        .glow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none; /* Allow interaction with elements behind it */
            z-index: -1; /* Below content but above canvas */
        }
        .left-glow, .right-glow {
            position: absolute;
            width: 500px; /* Adjust size as needed */
            height: 500px; /* Adjust size as needed */
            border-radius: 50%;
            filter: blur(150px); /* Soft glow */
            opacity: 0.3; /* Adjust intensity */
            background-color: #2775ca; /* Blue glow */
        }
        .left-glow {
            top: 10%;
            left: -10%;
        }
        .right-glow {
            bottom: 5%;
            right: -10%;
        }
        #leftsvg, #rightsvg {
            position: fixed;
            height: 100%;
            top: 0;
            z-index: -1; /* Behind content */
            opacity: 0.1; /* Subtle effect */
        }
        #leftsvg { left: 0; }
        #rightsvg { right: 0; }

        /* Header Styles */
        header {
            background: rgba(0, 0, 0, 0.4); /* Slightly transparent background */
            padding: 10px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }
        nav {
            max-width: 1150px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo {
            height: 40px;
            width: auto;
        }
        .title {
            color: #2775ca; /* Blue from original site */
            font-size: 28px;
            font-weight: 900;
            margin: 0;
            text-shadow: 0 0 15px rgba(39, 117, 202, 0.7);
        }

        /* Footer Styles */
        .inner-footer {
            max-width: 1150px;
            margin: 0 auto;
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end; /* Align items to the bottom */
            flex-wrap: wrap;
            gap: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.4);
            margin-top: auto; /* Push footer to the bottom */
        }
        .inner-footer .col {
            flex: 1;
            min-width: 250px;
        }
        .inner-footer .title {
            font-size: 18px;
            font-weight: 800;
            color: #2775ca;
            margin-bottom: 10px;
        }
        .inner-footer .subtitle {
            font-size: 14px;
            color: var(--muted);
            line-height: 1.5;
            display: block; /* Ensure it takes full width */
        }
        .inner-footer .copyright {
            font-size: 14px;
            color: var(--muted);
            line-height: 1.5;
        }

        /* Slot Picker Specific Styles */
        :root{
            --bg1:#0c0f16;
            --card:#1b2236;
            --chip:#4c52ff;
            --text:#e8ecff;
            --muted:#93a1bd;
            --btn:#3b42ff;
            --btn-hover:#2b31d8;
            --radius:16px;
            --shadow:0 10px 30px rgba(0,0,0,.35)
        }
        /* No need for * or body, already handled */
        .app{
            max-width:1150px;
            margin:24px auto; /* Add margin-top for separation from header */
            padding: 0 24px; /* Add padding to sides for smaller screens */
            display:grid;
            grid-template-columns:1.2fr 1fr;
            gap:24px;
            flex-grow: 1; /* Allow the app content to grow and fill space */
        }
        @media (max-width: 768px) {
            .app {
                grid-template-columns: 1fr; /* Stack columns on smaller screens */
            }
        }
        .panel{
            background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
            border:1px solid rgba(255,255,255,.08);
            padding:18px;
            border-radius:20px;
            box-shadow:var(--shadow)
        }
        .panel h2{
            margin:0 0 12px;
            font-size:26px
        }
        .row{
            display:flex;
            gap:10px;
            flex-wrap:wrap;
            margin:12px 0 6px
        }
        .controls{
            display:flex;
            gap:10px;
            flex-wrap:wrap
        }
        .chip{
            background:transparent;
            color:var(--text);
            padding:10px 14px;
            border-radius:999px;
            border:1px solid rgba(255,255,255,.18);
            font-weight:800;
            cursor:pointer
        }
        .chip.active{
            background:var(--chip);
            border-color:transparent
        }
        .btn{
            background:var(--btn);
            color:#fff;
            border:0;
            border-radius:12px;
            padding:12px 16px;
            font-weight:800;
            cursor:pointer
        }
        .btn:hover{
            background:var(--btn-hover)
        }
        .right{
            display:grid;
            gap:16px;
            grid-template-rows:auto 1fr auto
        }
        .card-wrap{
            display:grid;
            place-items:center;
            min-height:560px
        }
        .card{
            width:360px;
            aspect-ratio:720/944;
            height:auto;
            perspective:1200px;
            filter:drop-shadow(0 20px 40px rgba(0,0,0,.45));
        }
        .card-inner{
            position:relative;
            width:100%;
            height:100%;
            transform-style:preserve-3d;
            transition:transform .7s cubic-bezier(.2,.7,.2,1);
            border-radius:var(--radius);
            overflow:hidden;
            border:1px solid rgba(255,255,255,.08);
            background:var(--card)
        }
        .card.flipped .card-inner{
            transform:rotateY(180deg)
        }
        .face{
            position:absolute;
            inset:0;
            padding:12px;
            display:grid;
            place-items:center;
            backface-visibility:hidden;
            -webkit-backface-visibility:hidden
        }
        .front{
            background:#151b2b;
        }
        .back{
            background:#0f1322;
            transform:rotateY(180deg)
        }
        #slotImgFront,#slotImgBack{
            max-width:100%;
            max-height:100%;
            object-fit:contain;
            border-radius:12px;
            box-shadow:0 6px 18px rgba(0,0,0,.35)
        }
        #slotImgFront{
            transform:scaleX(-1); /* mirrored on the front */
        }
        #slotImgBack{
            transform:none;       /* normal on the back */
        }
        .meta{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px
        }
        .meta .title{
            font-size:22px;
            font-weight:800
        }
        .meta .sub{
            color:var(--muted);
            font-weight:700
        }
        .foot{
            display:flex;
            gap:12px;
            flex-wrap:wrap;
            align-items:center;
            justify-content:flex-end
        }
        .pill{
            padding:8px 10px;
            border-radius:999px;
            border:1px dashed rgba(255,255,255,.18);
            color:var(--muted)
        }
    </style>
</head>
<body>
    <!-- Toast notifications (if needed) -->
    <div id="toast">
        <span id="message"></span>
    </div>

    <!-- Draggable Player -->
    <div id="draggable-player" class="draggable">
        <div id="controls" class="controls">
            <div id="drag-handle" class="drag-handle">&#x2630;</div>
            <button id="close-btn" class="close-btn">&times;</button>
        </div>
        <iframe src="https://player.kick.com/projectgamba" frameborder="0" allow="autoplay; fullscreen" allowfullscreen>
        </iframe>
    </div>
    <!-- Minimized Player Icon -->
    <div id="minimized-icon" class="minimized-icon">
        <button id="open-btn" class="open-btn">
            <img src="/assets/logo1.png" alt="ProjectGamba Logo" style="height: 30px; width: auto;"/>
        </button>
    </div>

    <!-- Particle Background Canvas -->
    <canvas id="particleCanvas"></canvas>

    <!-- Glow Effects -->
    <div class="glow-container">
        <div class="left-glow"></div>
        <div class="right-glow"></div>
    </div>
    <!-- Decorative SVGs -->
    <object type="image/png" data="/assets/left-rainbet.png" id="leftsvg" height="100%"></object>
    <object type="image/png" data="/assets/right-rainbet.png" id="rightsvg" height="100%"></object>

    <!-- Header -->
    <header>
        <nav>
            <div class="logo-title">
                <img src="/assets/logo1.png" alt="Site logo" class="logo">
                <h1 class="title">ProjectGamba</h1>
            </div>
            <!-- Removed nav-links as they were specific to the old content -->
        </nav>
    </header>

    <!-- Main Slot Picker Application Content -->
    <div class="app">
        <div class="panel">
            <h2>Providers</h2>
            <div class="controls">
                <button class="btn" id="selectAll">Select All</button>
                <button class="btn" id="deselectAll">Deselect All</button>
                <span class="pill" id="status">Loading /slots.csv…</span>
            </div>
            <div id="providers" class="row"></div>
            <small id="counts"></small>
        </div>

        <div class="right">
            <div class="panel card-wrap">
                <div class="card" id="card">
                    <div class="card-inner">
                        <!-- FRONT = mirrored -->
                        <div class="face front"><img id="slotImgFront" alt=""></div>
                        <!-- BACK = normal -->
                        <div class="face back"><img id="slotImgBack" alt=""></div>
                    </div>
                </div>
            </div>

            <div class="panel meta">
                <div>
                    <div class="title" id="slotName">—</div>
                    <div class="sub" id="slotProvider">—</div>
                </div>
                <button class="btn" id="pickBtn">Pick A Slot</button>
            </div>

            <div class="foot"><small class="pill" id="filterSummary">0 providers selected</small></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="inner-footer">
        <div class="col-5">
            <div class="content">
                <div class="company"></div><br>
                <span class="copyright">ProjectGamba<br> All Right Reserved 2025.</span>
            </div>
        </div>
        <div class="col">
            <span class="title">Info</span>
            <a href="/" class=""><span class="subtitle">Terms of Service</span></a>
            <a href="/" class=""><span class="subtitle">Privacy Policy</span></a>
        </div>
        <!-- Removed socials column from footer as it was redundant/specific to old content -->
        <div class="col">
            <span class="title">BeGambleAware.com</span>
            <span class="subtitle" style="font-size: 9px;">Responsible Gambling Advisory: While gambling can be entertaining,
                it's crucial to be aware of the associated risks. Exercise self-control,
                set limits, and seek support if needed. Enjoy the excitement responsibly
                and prioritize your well-being. We are not responsible for any losses or damages caused by gambling.
            </span>
        </div>
    </footer>

    <!-- Scripts from original site and new Slot Picker -->
    <script src="/js/particles.js"></script> <!-- Assuming this handles the background particles -->
    <script src="/js/toast.js"></script> <!-- If toast notifications are desired -->
    <script>
        // Draggable player script from the original site
        window.onload = function () {
            var player = document.getElementById('draggable-player');
            var dragHandle = document.getElementById('drag-handle');
            var closeBtn = document.getElementById('close-btn');
            var minimizedIcon = document.getElementById('minimized-icon');
            var openBtn = document.getElementById('open-btn');

            let isDragging = false;
            let startX, startY, initialMouseX, initialMouseY;

            dragHandle.addEventListener('mousedown', function (e) {
                isDragging = true;
                initialMouseX = e.clientX;
                initialMouseY = e.clientY;
                startX = player.offsetLeft;
                startY = player.offsetTop;
                player.style.cursor = 'grabbing';
            });

            document.addEventListener('mousemove', function (e) {
                if (!isDragging) return;
                let dx = e.clientX - initialMouseX;
                let dy = e.clientY - initialMouseY;
                player.style.left = startX + dx + 'px';
                player.style.top = startY + dy + 'px';
            });

            document.addEventListener('mouseup', function () {
                isDragging = false;
                player.style.cursor = 'grab';
            });

            closeBtn.onclick = function () {
                player.style.display = 'none';
                minimizedIcon.style.display = 'flex'; // Show the minimized icon
            };

            openBtn.onclick = function () {
                player.style.display = 'block';
                minimizedIcon.style.display = 'none'; // Hide the minimized icon
            };

            // Initialize position to bottom-right if not set by user dragging
            if (!player.style.left && !player.style.top) {
                player.style.left = (window.innerWidth - player.offsetWidth - 15) + 'px';
                player.style.top = (window.innerHeight - player.offsetHeight - 15) + 'px';
            }
        };
    </script>

    <!-- PapaParse for CSV parsing (new for Slot Picker) -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- Slot Picker's main JavaScript logic -->
    <script>
        let allSlots = [], providers = new Set(), selected = new Set();
        const els = {
            providers: document.getElementById('providers'),
            selectAll: document.getElementById('selectAll'),
            deselectAll: document.getElementById('deselectAll'),
            filterSummary: document.getElementById('filterSummary'),
            counts: document.getElementById('counts'),
            pickBtn: document.getElementById('pickBtn'),
            card: document.getElementById('card'),
            slotImgFront: document.getElementById('slotImgFront'),
            slotImgBack: document.getElementById('slotImgBack'),
            slotName: document.getElementById('slotName'),
            slotProvider: document.getElementById('slotProvider'),
            status: document.getElementById('status')
        };

        function upscale(url) {
            if (!url) return url;
            try {
                const u = new URL(url, location.href);
                u.searchParams.set('w', '720');
                u.searchParams.set('h', '944');
                u.searchParams.set('fit', 'min');
                u.searchParams.set('auto', 'format');
                return u.toString();
            } catch (e) { return url; }
        }

        const byProvider = () => allSlots.filter(s => selected.size ? selected.has(s.provider) : true);

        function renderProviders() {
            els.providers.innerHTML = '';
            [...providers].sort().forEach(p => {
                const chip = document.createElement('button');
                chip.className = 'chip' + (selected.has(p) ? ' active' : '');
                chip.textContent = p;
                chip.onclick = () => { selected.has(p) ? selected.delete(p) : selected.add(p); renderProviders(); refreshCounts(); }
                els.providers.appendChild(chip);
            });
            refreshCounts();
        }

        function refreshCounts() {
            els.filterSummary.textContent = `${selected.size} provider${selected.size !== 1 ? 's' : ''} selected`;
            const visible = byProvider().length;
            els.counts.textContent = allSlots.length ? `${visible} of ${allSlots.length} slots match` : '';
        }

        function flipToBack() { els.card.classList.add('flipped'); }
        function flipToFront() { els.card.classList.remove('flipped'); }

        function showImages(url) {
            els.slotImgFront.src = url;
            els.slotImgBack.src = url;
        }

        function pickRandom() {
            const pool = byProvider();
            if (!pool.length) {
                // Using a custom message box instead of alert()
                const messageDiv = document.createElement('div');
                messageDiv.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: #333; color: white; padding: 20px; border-radius: 10px;
                    box-shadow: var(--shadow); z-index: 10000; text-align: center;
                `;
                messageDiv.innerHTML = `
                    <p>No slots in current filter.</p>
                    <button class="btn" onclick="this.parentNode.remove()">OK</button>
                `;
                document.body.appendChild(messageDiv);
                return;
            }
            const choice = pool[Math.floor(Math.random() * pool.length)];
            const hi = upscale(choice.image);

            const pre = new Image();
            pre.onload = () => {
                showImages(hi);
                els.slotName.textContent = choice.name;
                els.slotProvider.textContent = choice.provider;
                flipToBack();
            };
            pre.onerror = () => {
                els.slotName.textContent = choice.name;
                els.slotProvider.textContent = `${choice.provider} (image unavailable)`;
                flipToBack();
            };

            if (els.card.classList.contains('flipped')) {
                flipToFront();
                setTimeout(() => pre.src = hi, 350);
            } else {
                setTimeout(() => pre.src = hi, 60);
            }
        }

        async function loadCSV() {
            try {
                // Ensure /slots.csv is available at the root of your deployment
                const res = await fetch('/slots.csv', { cache: 'no-store' });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const text = await res.text();
                const parsed = Papa.parse(text, { header: true, skipEmptyLines: true, transformHeader: h => h.trim().toLowerCase() });
                allSlots = parsed.data.map(r => ({
                    name: (r.name || r.slot || r.title || '').trim(),
                    provider: (r.provider || r.vendor || r.studio || '').trim(),
                    image: (r.image || r.img || r.thumbnail || '').trim()
                })).filter(x => x.name && x.provider && x.image);
                providers = new Set(allSlots.map(s => s.provider));
                selected = new Set(providers);
                renderProviders();
                els.status.textContent = `Loaded ${allSlots.length} slots`;
            } catch (err) {
                els.status.textContent = `Failed to load /slots.csv (${err.message}). Make sure 'slots.csv' is in the root directory.`;
                console.error("Error loading CSV:", err);
            }
        }

        els.selectAll.onclick = () => { selected = new Set(providers); renderProviders(); };
        els.deselectAll.onclick = () => { selected = new Set(); renderProviders(); };
        els.pickBtn.onclick = pickRandom;
        window.addEventListener('keydown', e => { if (e.code === 'Space') { e.preventDefault(); pickRandom(); } });

        loadCSV();
    </script>
</body>
</html>
